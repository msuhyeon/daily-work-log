# S3 정적 배포
> Next.js 기반으로 프로젝트를 개발했지만, 뒤늦게 **S3에 정적 사이트 배포**를 해야한다고 전달받았다.<br/>
> SSR이나 App Router를 사용하게 되면 Node 서버가 필요해서 인스턴스 시간 당 요금이 발생하기 때문이다.<br/>
> 결론은 Next.js가 제공하는 핵심 기능들이 사실상 무용지물이 되었는데 이 과정을 글로 남겨 보려한다.

<br/>

## Next.js가 무쓸모가 된 이유

1. `서버 컴포넌트`와 `SSR`이 **불가**하다.
  - `next export`는 **서버가 없는 순수 정적 HTML+JS**만 배포한다.
  - `usePathname`, `router.push`, 서버 컴포넌트, API Route 등 **Next.js의 App Router 기능 대부분이 동작하지 않았다.**
  - 또 RSC 전용 요청은 서버가 없으므로 실패하여 **무한 리다이렉트가** 발생했다.
2. `라우팅` 기능 동작 **불가**
  - `router.push()` 같은 Next.js 라우터는 **정적 사이트에서 정상 동작하지 않음**.
  - CloudFront/S3가 `/page` → `/page/index.html` 매핑을 못 해 **404 또는 무한 리다이렉트** 발생.
  - 결과적으로 **`window.location.replace()` 또는 `react-router-dom` 같은 별도 라우터를 써야 하는 상황**이다.
  - 그래도 UX를 고려하여.. `react-router-dom`을 셋팅할 계획이다.
3. `Next.js`의 장점이 **사라짐**
- **페이지 프리렌더링(SSR)**, **이미지 최적화(`next/image`)**, **동적 API Routes** 등 Next.js의 이점이 전부 사용 불가하게 되었다.
- 그로 인해 당연히 `NextAuth` 또한 사용이 불가능하여 코드를 지울 수 밖에 없었다.
- `output: 'export'` 설정으로 인해 사실상 React.js로 만드는게 더 나은 상황이 되버린 것 이다.

<br/>

### 결론
- S3 정적 배포로 인해 Next.js가 가진 **App Router, 서버 컴포넌트, API Routes, 이미지 최적화** 등 핵심 기능이 **무용지물**이 되었고
- 마감일자에 맞추기 위해 `react-router-dom` 기반으로 라우팅을 전환해 빠르게 리팩토링을 마쳐야함.
- 인프라 아키텍처 결정 시 **프론트엔드 기술 스택**과 **배포 전략**의 호환성을 고려하기 위해 **프론트엔드 개발자의 참여**는 필수적이다‼️
- 다음에 이런 케이스가 있다면 논의 및 검토를 함께 할 수 있도록 요청해야겠다.
